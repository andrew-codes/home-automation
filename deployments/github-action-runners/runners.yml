apiVersion: actions.summerwind.dev/v1alpha1
kind: Runner
metadata:
  name: github-action-runner-amd-1
  namespace: actions-runner-system
spec:
  labels:
    - amd64-runner
  repository: andrew-codes/home-automation
  dockerEnabled: true
  dockerdWithinRunnerContainer: false
  imagePullSecrets:
    - name: regcred
  image: docker-registry:5000/github-action-runner:latest
  imagePullPolicy: Always
  command:
    - sh
  args:
    - "-c"
    - "wrapdocker.sh && /entrypoint.sh"
  resources:
    requests:
      ephemeral-storage: "2Gi"
    limits:
      ephemeral-storage: "4Gi"
  env:
    - name: DOCKER_HOST
      value: localhost:2736
  volumeMounts:
    - name: kubectl-config-volume
      mountPath: /home/runner/.kube/config
      subPath: value
    - name: ssh-volume
      mountPath: /home/runner/.ssh/id_rsa
      subPath: value
  volumes:
    - name: kubectl-config-volume
      configMap:
        name: kube-config
    - name: ssh-volume
      configMap:
        name: home-automation-private-key
        defaultMode: 0600
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/arch
                operator: In
                values:
                  - amd64

---
apiVersion: actions.summerwind.dev/v1alpha1
kind: Runner
metadata:
  name: github-action-runner-amd-2
  namespace: actions-runner-system
spec:
  labels:
    - amd64-runner
  repository: andrew-codes/home-automation
  dockerEnabled: true
  dockerdWithinRunnerContainer: false
  imagePullSecrets:
    - name: regcred
  image: docker-registry:5000/github-action-runner:latest
  command:
    - sh
  args:
    - "-c"
    - "wrapdocker.sh && /entrypoint.sh"
  resources:
    requests:
      ephemeral-storage: "2Gi"
    limits:
      ephemeral-storage: "4Gi"
  imagePullPolicy: Always
  env:
    - name: DOCKER_HOST
      value: localhost:2736
  volumeMounts:
    - name: kubectl-config-volume
      mountPath: /home/runner/.kube/config
      subPath: value
    - name: ssh-volume
      mountPath: /home/runner/.ssh/id_rsa
      subPath: value
  volumes:
    - name: kubectl-config-volume
      configMap:
        name: kube-config
    - name: ssh-volume
      configMap:
        name: home-automation-private-key
        defaultMode: 0600
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
              - key: kubernetes.io/arch
                operator: In
                values:
                  - amd64