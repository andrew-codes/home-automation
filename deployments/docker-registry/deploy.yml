---
- hosts: all
  become: yes
  become_method: sudo
  become_user: root
  gather_facts: yes
  connection: ssh

  tasks:
    - name: Volume
      shell: mkdir -p /mnt/registry

    - name: Stop registry
      shell: docker stop registry || true

    - name: Remove container
      shell: docker container rm registry || true

    - name: Run registry as service
      shell: >
        docker run -d \
          --name registry \
          -v /mnt/registry:/var/lib/registry \
          -e REGISTRY_HTTP_ADDR=0.0.0.0:80 \
          -p 5000:80 \
          registry:2
