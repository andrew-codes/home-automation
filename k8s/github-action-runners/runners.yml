apiVersion: actions.summerwind.dev/v1alpha1
kind: RunnerDeployment
metadata:
  name: github-action-runners
  namespace: actions-runner-system
spec:
  replicas: 3
  template:
    spec:
      labels:
        - amd64-runner
        - nodejs-runner
      repository: andrew-codes/home-automation
      dockerEnabled: true
      dockerdWithinRunnerContainer: false
      imagePullSecrets:
        - name: regcred
      image: docker.smith-simms.family:5000/github-action-runner:latest
      imagePullPolicy: Always
      volumeMounts:
        - name: kubectl-config-volume
          mountPath: /home/runner/.kube/config
          subPath: kubectl-config
        - name: ssh-volue
          mountPath: /home/runner/.ssh/id_rsa
          subPath: id_rsa
      volumes:
        - name: kubectl-config-volume
          secret:
            secretName: kubectl-config
        - name: ssh-volume
          secret:
            defaultMode: 0600
            secretName: ssh-secrets
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
              - matchExpressions:
                  - key: kubernetes.io/arch
                    operator: In
                    values:
                      - amd64