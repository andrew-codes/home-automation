name: Update GitHub Runners
on:
  schedule:
    - cron: "0 1 * * *"
jobs:
  push_image:
    name: Update docker GitHub action runner image
    runs-on: amd64-runner
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Docker system prune
        run: docker system prune -f
      - name: Install deps
        run: yarn
        env:
          AZURE_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
          AZURE_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}
          AZURE_KEY_VAULT_NAME: ${{ secrets.AZURE_KEY_VAULT_NAME }}
          AZURE_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
      - name: Build/push docker image
        run: yarn image/push github-action-runners
        env:
          AZURE_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
          AZURE_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}
          AZURE_KEY_VAULT_NAME: ${{ secrets.AZURE_KEY_VAULT_NAME }}
          AZURE_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
