input_text:
  defect_summary:
    name: Defect Summary
    initial: ""

rest_command:
  create_github_issue:
    url: https://api.github.com/repos/andrew-codes/home-automation/issues
    method: POST
    headers:
      authorization: !secret GITHUB_AUTHORIZATION_HEADER
      accept: "application/json, text/html"
      user-agent: "Mozilla/5.0 {{ useragent }}"
    payload: '{"title": "{{ states("input_text.defect_summary") }}","body": "","labels": ["bug", "reported"]}'
    content_type: "application/json; charset=utf-8"
    verify_ssl: true

  create_jira_issue:
    url: https://smith-simms.atlassian.net/rest/api/3/issue
    method: POST
    headers:
      authorization: !secret JIRA_AUTHORIZATION_HEADER
      accept: "application/json, text/html"
      user-agent: "Mozilla/5.0 {{ useragent }}"
    payload: |
      {
        "update": {},
        "fields": {
          "summary": "{{ states("input_text.defect_summary") }}",
          "issuetype": {
            "id": "10004"
          },
          "project": {
            "id": "10000"
          },
          "labels": [
            "reported",
            "home-automation"
          ]
        }
      }
    content_type: "application/json; charset=utf-8"
    verify_ssl: true

script:
  report_defect:
    sequence:
      - service: rest_command.create_jira_issue
      - service: input_text.set_value
        data:
          entity_id: input_text.defect_summary
          value: ""