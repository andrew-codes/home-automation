automation:
  - alias: Notify family of water leak
    id: notify_family_of_water_leak
    trigger:
      - platform: state
        entity_id: binary_sensor.pending_system_alerts
        to: "on"
    action:
      - service: switch.turn_off
        entity_id: switch.shutoff_valve
      - service: notify.all_devices
        data:
          title: "Critical Alert: Water Leak"
          message: Potential water leak detected. Water has been shut off.
          data:
            actions:
              - action: "WATER_LEAK_NON_ISSUE"
                activationMode: background
                authenticationRequired: false
                behavior: default
                destructive: true
                title: "Not an Issue: Dismiss"
            push:
              sound:
                name: default
                critical: 1
                volume: 1.0
