automation:
  - alias: Notify family of water leak
    id: notify_family_of_water_leak
    trigger:
      - platform: state
        entity_id: switch.shutoff_valve
        to: "off"
    action:
      - service: notify.all_devices
        data:
          title: "Critical Alert: Water Leak"
          message: Potential water leak detected. Water has been shut off.
          data:
            actions:
              - action: "RESOLVED_WATER_LEAK"
                activationMode: background
                authenticationRequired: false
                behavior: default
                destructive: true
                title: "Issue Resolved"
            push:
              sound:
                name: default
                critical: 1
                volume: 1.0

  - alias: Resolved water leak
    id: resovled_water_leak
    trigger:
      platform: event
      event_type: mobile_app_notification_action
      event_data:
        actionName: RESOLVED_WATER_LEAK
    action:
      - service: switch.turn_on
        entity_id: switch.shutoff_valve
