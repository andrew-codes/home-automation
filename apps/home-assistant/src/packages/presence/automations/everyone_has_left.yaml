automation:
  - alias: Everyone has left
    id: everyone_has_left
    trigger:
      - platform: state
        entity_id: group.tracked_presence
        to: "not_home"
    action:
      # Set thermostat
      - service: climate.set_preset_mode
        entity_id: climate.main_floor
        data:
          preset_mode: Away
      # Lock all doors that are not already locked
      - choose:
          - conditions:
              condition: state
              entity_id: lock.front_door
              state: unlocked
            sequence:
              - service: lock.lock
                entity_id: lock.front_door
      - choose:
          - conditions:
              condition: state
              entity_id: lock.car_port_door
              state: unlocked
            sequence:
              - service: lock.lock
                entity_id: lock.car_port_door
      # - choose:
      #     - conditions:
      #         condition: state
      #         entity_id: lock.basement_door
      #         state: unlocked
      #       sequence:
      #         - service: lock.lock
      #           entity_id: lock.basement_door
      # Turn off all lights
      # Turn off TVs
      - service: media_player.turn_off
        entity_id: media_player.gaming_room_media_player
