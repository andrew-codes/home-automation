media_player:
  # This is the primary media player for automations.
  - name: Gaming Room Media Player
    platform: universal
    children:
      - media_player.gaming_room_universal_gaming_pc
      - media_player.gaming_room_universal_playstation_5
      - media_player.gaming_room_universal_media_player
    state_template: >
      {% if is_state('media_player.gaming_room_universal_playstation_5', 'on') %}
      on
      {% elif is_state('media_player.gaming_room_universal_gaming_pc', 'on') %}
      on
      {% elif is_state('media_player.gaming_room_universal_media_player', 'on') %}
      on
      {% elif is_state('media_player.gaming_room_universal_media_player', 'playing') %}
      on
      {% else %}
      off
      {% endif %}
    commands:
      turn_off:
        service: script.turn_on
        target:
          entity_id: script.gaming_room_turn_off_all_media_players
      volume_set:
        service: media_player.volume_set
        data_template:
          entity_id: >
            {{ state_attr('media_player.gaming_room_media_player', 'active_child') }}
          volume_level: "{{ volume_level }}"
      volume_up:
        service: media_player.volume_up
        data_template:
          entity_id: >
            {{ state_attr('media_player.gaming_room_media_player', 'active_child') }}
      volume_down:
        service: media_player.volume_down
        data_template:
          entity_id: >
            {{ state_attr('media_player.gaming_room_media_player', 'active_child') }}
      volume_mute:
        service: media_player.volume_mute
        data_template:
          entity_id: >
            {{ state_attr('media_player.gaming_room_media_player', 'active_child') }}
          is_volume_muted: "{{ is_volume_muted }}"
      select_source:
        service: media_player.select_source
        data_template:
          entity_id: >
            {{ state_attr('media_player.gaming_room_media_player', 'active_child') }}
          source: "{{ source }}"
    attributes:
      is_volume_muted: media_player.gaming_room_avr|is_volume_muted
      volume_level: media_player.gaming_room_avr|volume_level
