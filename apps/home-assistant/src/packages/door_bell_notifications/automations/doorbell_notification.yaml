automation:
  - alias: Guests at door notification
    id: guests_at_door_notification
    trigger:
      - platform: state
        id: carport_door
        entity_id: binary_sensor.guests_detected_at_carport_door
        to: "on"
        from: "off"
      - platform: state
        id: front_door
        entity_id: binary_sensor.guests_detected_at_front_door
        to: "on"
        from: "off"
    action:
      - choose:
          - conditions:
              condition: trigger
              id: carport_door
            sequence:
              - service: notify.all_devices
                data_template:
                  title: "Guests at door"
                  message: "Guests at carport door."
                  data:
                    entity_id: camera.carport_doorbell_high
                    tag: "carport-doorbell"
                    when: "{{ as_timestamp(now())  }}"
                    url: /lovelace/security
                    click_action: /lovelace/security
                    actions:
                      - action: "URI"
                        title: "View Live Feed"
                        uri: "/lovelace/security"
                    push:
                      thread-id: security
          - conditions:
              condition: trigger
              id: front_door
            sequence:
              - service: notify.all_devices
                data_template:
                  title: "Guests at door"
                  message: "Guests at front door."
                  data:
                    entity_id: camera.front_door_doorbell_high
                    tag: "front-doorbell"
                    when: "{{ as_timestamp(now()) }}"
                    url: /lovelace/security
                    click_action: /lovelace/security
                    actions:
                      - action: "URI"
                        title: "View Live Feed"
                        uri: "/lovelace/security"
                    push:
                      thread-id: security
