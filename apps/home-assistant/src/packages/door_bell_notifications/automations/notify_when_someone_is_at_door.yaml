automation:
  - alias: Notify family members when someone is at the door and no one is home
    id: door_bell_notifications_notify_guests_at_door
    trigger:
      - platform: template
        id: front_door
        value_template: "{% if states('sensor.front_door_person')|int > 0 %}true{% endif %}"
        for: "00:00:25"
      - platform: template
        id: car_port_door
        value_template: "{% if states('sensor.car_port_door_person')|int > 0 %}true{% endif %}"
        for: "00:00:25"
      - platform: state
        id: front_door
        entity_id: binary_sensor.doorbell_front_doorbell
        to: "on"
      - platform: state
        id: car_port_door
        entity_id: binary_sensor.doorbell_carport_doorbell
        to: "on"
    action:
      - service: notify.mobile_app_andrew_s_iphone
        data_template:
          title: "Guests at the door"
          message: >
            {% if trigger.id == 'car_port_door' %}{{ states('sensor.car_port_door_person') }} {% if states('sensor.car_port_door_person')|int > 1 %}people{% else %}person{% endif %}{% else %}{{ states('sensor.front_door_person') }} {% if states('sensor.front_door_person')|int > 1 %}people{% else %}person{% endif %}{% endif %} at {% if trigger.id == 'car_port_door' %}car port door{% else %}front door{% endif %}.
          data:
            url: /lovelace/home
            push:
              thread-id: security
      - service: notify.mobile_app_dorri_s_iphone
        data_template:
          title: "Guests at the door"
          message: >
            {% if trigger.id == 'car_port_door' %}{{ states('sensor.car_port_door_person') }} {% if states('sensor.car_port_door_person')|int > 1 %}people{% else %}person{% endif %}{% else %}{{ states('sensor.front_door_person') }} {% if states('sensor.front_door_person')|int > 1 %}people{% else %}person{% endif %}{% endif %} at {% if trigger.id == 'car_port_door' %}car port door{% else %}front door{% endif %}.
          data:
            url: /lovelace/home
            push:
              thread-id: security
