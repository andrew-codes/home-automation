input_text:
  target_daytime_temp_input:
    name: Target Daytime Temperature Input
    initial: "70"
  target_nighttime_temp_input:
    name: Target Nightime Temperature Input
    initial: "68"
  target_away_low_temp_input:
    name: Target Away Low Temperature Input
    initial: "60"
  target_away_high_temp_input:
    name: Target Away High Temperature Input
    initial: "78"

sensor:
  - platform: template
    sensors:
      target_daytime_temp:
        friendly_name: Target Daytime Temperature
        value_template: "{{ states('input_text.target_daytime_temp_input') | default(70) | int }}"
      target_nighttime_temp:
        friendly_name: Target Nightime Temperature
        value_template: "{{ states('input_text.target_nighttime_temp_input') | default(68) | int }}"
      target_away_low_temp:
        friendly_name: Target Away Low Temperature
        value_template: "{{ states('input_text.target_nighttime_temp_input') | default(60) | int }}"
      target_away_high_temp:
        friendly_name: Target Away High Temperature
        value_template: "{{ states('input_text.target_nighttime_temp_input') | default(77) | int }}"
      season:
        friendly_name: Hot or cold season
        value_template: >
          {% if (state_attr('weather.home', 'temperature')|int) <= 60 %}
            cold
          {% else %}
            hot
          {%endif %}
      target_low_temp:
        friendly_name: Target Low Temperature
        value_template: >
          {% if is_state('group.tracked_presence', 'away') %}
            {% if is_state('sensor.season', 'cold') %}
              "{{ states('sensor.target_away_low_temp') | int }}"
            {% else %}
              "{{ ((states('sensor.target_away_high_temp') | int) - 5) | int }}"
            {% endif %}
          {% else %}
            {% if is_state('group.family_is_sleeping', 'on') %}
                {% if is_state('sensor.season', 'cold') %}
                  "{{ states('sensor.target_nighttime_temp') | int }}"
                {% else %}
                  "{{ ((states('sensor.target_nighttime_temp') | int) - 6) | int }}"
                {% endif %}
            {% else %}
              {% if is_state('sensor.season', 'cold') %}
                  "{{ ((states('sensor.target_daytime_temp') | int) - 1) | int }}"
                {% else %}
                  "{{ ((states('sensor.target_daytime_temp') | int) - 6) | int}}"
                {% endif %}
            {% endif %}
          {% endif %}
      target_high_temp:
        friendly_name: Target High Temperature
        value_template: "{{ ((states('sensor.target_min_temp') | int) + 4) | int }}"
