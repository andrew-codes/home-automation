---
- hosts: all
  gather_facts: yes
  connection: winrm
  vars_files:
    - ../.secrets/ansible-secrets.yml

  tasks:
    - name: Create local game user
      win_user:
        name: "{{ gaming_room_gaming_pc_username }}"
        update_password: on_create
        password_never_expires: yes
        password_expired: no

    - import_playbook: playbooks/install_software.yml

    - name: Enable HA Ping through firewall
      win_firewall_rule:
        name: "HA Ping"
        description: "Allow ping from Home Assistant"
        direction: In
        protocol: icmpv4
        icmp_type_code:
          - "8:*"
        profiles: private
        action: Allow
        enabled: yes
        state: present

    - import_playbook: playbooks/tools.yml
